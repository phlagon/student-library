<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TheoLib Admin - Master Control</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    </head>
<body>
    <div id="master-panel" class="hidden">
        <div class="nav-tabs">
            <button id="t-inv" class="tab-btn active" onclick="switchTab('inv')">Inventory</button>
            <button id="t-mem" class="tab-btn" onclick="switchTab('mem')">Monitoring</button>
            <button id="t-msg" class="tab-btn" onclick="switchTab('msg')">Messages</button> <button class="tab-btn" style="background:#ef4444; color:white; margin-left:auto;" onclick="location.reload()">Logout</button>
        </div>

        <div id="msg-section" class="hidden glass-card">
            <h2>ðŸ“¥ Inbox (Super Admin Only)</h2>
            <div id="inbox-list"></div>
        </div>
    </div>

<script>
    // ... config and login logic ...
    
    function setupUI() {
        if (!isSuperAdmin) {
            document.getElementById('t-msg').classList.add('hidden'); // Hide Inbox for College Admin
            // ... rest of previous setupUI ...
        }
    }

    function initAdmin() {
        // ... previous init ...
        
        if (isSuperAdmin) {
            // Fetch Messages
            db.collection("admin_messages").orderBy("date", "desc").onSnapshot(snap => {
                const list = document.getElementById('inbox-list');
                list.innerHTML = "";
                snap.forEach(doc => {
                    const m = doc.data();
                    list.innerHTML += `<div class="glass-card" style="margin-bottom:10px; font-size:13px;">
                        <b style="color:var(--blue)">${m.type}</b> from ${m.user} (${m.college || 'General'})<br>
                        ${m.book ? `<b>Book:</b> ${m.book} | <b>Author:</b> ${m.author}<br>` : ''}
                        ${m.message ? `<b>Note:</b> ${m.message}` : ''}
                        <div style="text-align:right"><button class="btn-sm" style="background:red" onclick="deleteMsg('${doc.id}')">Delete</button></div>
                    </div>`;
                });
            });
        }
    }

    async function deleteMsg(id) { if(confirm("Delete message?")) await db.collection("admin_messages").doc(id).delete(); }
    
    // ... rest of formatting and switchTab logic ...
</script>
</body>
</html>
